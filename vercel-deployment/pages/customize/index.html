<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
      <link rel="icon" type="image/png" href="../../../images/Reweave_logo-removebg-preview.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Customize Your Bag â€¢ Reweave</title>
  <link rel="stylesheet" href="../../../archive/development-files/css/styles.css" />
  <!-- Google Fonts (Poppins) -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <!-- Font Awesome for header icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/J6FzG7xOa7bY8dW3vY9y+Z9Z+8ZC1A6pZ4G6tJ1jG4kW0fF7e3lV2C5HnS9JZ7JwYlQ+o6YHg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* Minimal styling for the customizer UI */
    .customize-hero { padding: 40px 20px; text-align: center; }
    .customize-grid { display: grid; grid-template-columns: 320px 1fr; gap: 24px; padding: 20px; }
    .customize-panel { border: 1px solid #eee; border-radius: 8px; padding: 16px; background: #fff; }
    .customize-panel h3 { margin: 0 0 12px; font-weight: 600; }
    .control-group { margin-bottom: 16px; }
    .swatch-row { display: flex; gap: 8px; flex-wrap: wrap; }
    .swatch { width: 28px; height: 28px; border-radius: 50%; border: 1px solid #ccc; cursor: pointer; }
    .viewer { border: 1px solid #eee; border-radius: 8px; background: #f8f8f8; height: 520px; position: relative; }
    .viewer canvas { position: absolute; inset: 0; }
    .btn { display: inline-block; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; background: #fafafa; cursor: pointer; }
    .btn + .btn { margin-left: 8px; }
    .select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; background: #fff; }
    .note { font-size: 12px; color: #666; }
    @media (max-width: 900px) {
      .customize-grid { grid-template-columns: 1fr; }
      .viewer { height: 420px; }
    }
  </style>
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
      }
    }
  </script>
</head>
<body>
  <!-- Luxury header (consistent with other pages) -->
  <!-- Standardized Header Component for Reweave -->
<header class="header">
  <div class="header-container">
    <div class="nav-left">
      <button class="nav-btn" onclick="toggleMenu()">
        <i class="fas fa-bars"></i> Menu
      </button>
      <button class="nav-btn" onclick="window.location.href='pages/tryon/index.html'" title="AI Try-On">AI Try-On</button>
    </div>
    
    <a href="/index.html" class="logo">REWEAVE</a>
    
    <div class="nav-right">
      <button class="nav-btn cart-btn" onclick="window.location.href = '/pages/cart/index.html'"">
        <i class="fas fa-shopping-bag"></i>
        <span class="cart-count" id="cartCount">0</span>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Menu -->
<div class="mobile-menu" id="mobileMenu">
  <div class="menu-header">
    <h3>Menu</h3>
    <button class="nav-btn" onclick="toggleMenu()">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="menu-section">
    <div class="menu-title">Shop</div>
    <a href="pages/shop/index.html" class="menu-link">Shop All</a>
    <a href="pages/shop/index.html#new-arrivals" class="menu-link">New Arrivals</a>
    <a href="pages/shop/index.html#batik-heritage" class="menu-link">Batik Heritage</a>
    <a href="pages/shop/index.html#songket-collection" class="menu-link">Songket Collection</a>
    <a href="pages/shop/index.html#accessories" class="menu-link">Accessories</a>
  </div>
  
  <div class="menu-section">
    <div class="menu-title">Our Story</div>
    <a href="pages/story/index.html" class="menu-link">About Reweave</a>
    <a href="pages/artisan/index.html" class="menu-link">Artisan Craft</a>
    <a href="pages/culture/index.html" class="menu-link">Cultural Heritage</a>
    <a href="pages/impact/index.html" class="menu-link">Sustainability</a>
    <a href="pages/community/index.html" class="menu-link">Community</a>
  </div>
  
  <div class="menu-section">
    <div class="menu-title">Experience</div>
    <a href="pages/tryon/index.html" class="menu-link">AI Try-On</a>
    <a href="pages/customize/index.html" class="menu-link">Customize</a>
    <a href="pages/journal/index.html" class="menu-link">Journal</a>
  </div>
  
  <div class="menu-section">
    <div class="menu-title">Support</div>
    <a href="pages/team/index.html" class="menu-link">Contact Us</a>
    <a href="#" class="menu-link">Shipping & Returns</a>
    <a href="#" class="menu-link">Size Guide</a>
    <a href="#" class="menu-link">Care Instructions</a>
  </div>
</div>

  <main>
    <section class="customize-hero">
      <h1>Customize Your Bag</h1>
      <p class="note">Prototype viewer using a placeholder 3D shape. Your final GLB can drop in later.</p>
    </section>

    <section class="customize-grid">
      <aside class="customize-panel">
        <h3>Appearance</h3>
        <div class="control-group">
          <label>Body Color</label>
          <div class="swatch-row">
            <div class="swatch" data-color="#3a5a40" title="Forest" style="background:#3a5a40"></div>
            <div class="swatch" data-color="#8b1e3f" title="Burgundy" style="background:#8b1e3f"></div>
            <div class="swatch" data-color="#1a1a1a" title="Black" style="background:#1a1a1a"></div>
            <div class="swatch" data-color="#c49b63" title="Camel" style="background:#c49b63"></div>
          </div>
        </div>
        <div class="control-group">
          <label>Pattern</label>
          <div>
            <button class="btn" id="apply-texture-1">Apply Batik A</button>
            <button class="btn" id="apply-texture-2">Apply Batik B</button>
            <button class="btn" id="clear-texture">Clear Pattern</button>
          </div>
          <p class="note">Using images from your `images/` folder.</p>
        </div>
        <div class="control-group">
          <label>Hardware Finish</label>
          <select id="hardware-select" class="select">
            <option value="gold">Gold</option>
            <option value="silver">Silver</option>
            <option value="matte">Matte Black</option>
          </select>
        </div>
        <div class="control-group">
          <label>Components</label>
          <div>
            <button class="btn" id="toggle-handles">Toggle Handles</button>
          </div>
        </div>
        <div class="control-group">
          <label>Model</label>
          <div>
            <button class="btn" id="load-demo-glb">Load Demo GLB</button>
          </div>
          <p class="note">Optional: loads a public sample model to demonstrate GLB swap.</p>
        </div>
      </aside>

      <div class="viewer" id="bag-viewer"></div>
    </section>
  </main>

  <!-- Standardized Footer Component for Reweave -->
<footer class="footer">
  <div class="container">
    <div class="footer-brand">REWEAVE</div>
    <div class="footer-text">
      Sustainable fashion, reimagined. Crafting heritage into modern essentials.
    </div>
    <div class="footer-links">
      <a href="pages/story/index.html" class="footer-link">Our Story</a>
      <a href="pages/impact/index.html" class="footer-link">Sustainability</a>
      <a href="pages/community/index.html" class="footer-link">Community</a>
      <a href="pages/team/index.html" class="footer-link">Contact</a>
    </div>
    <div class="footer-trust">
      <span class="trust-badge">FPX Available</span>
      <span class="trust-badge">Visa</span>
      <span class="trust-badge">Mastercard</span>
      <span class="trust-badge">30-day Returns</span>
    </div>
  </div>
</footer>

  <!-- Luxury header interactions -->
  <script src="../../../archive/development-files/script.js"></script>

  <!-- 3D Customizer (Three.js) -->
  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';
    import { GLTFLoader } from 'https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js';
    import { RoundedBoxGeometry } from 'https://unpkg.com/three@0.160.0/examples/jsm/geometries/RoundedBoxGeometry.js';

    const container = document.getElementById('bag-viewer');
    const scene = new THREE.Scene();
    scene.background = null;

    // Camera & Renderer
    const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 100);
    camera.position.set(0.7, 0.7, 1.7);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // Lighting
    const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 0.9);
    hemi.position.set(0, 1, 0);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 0.6);
    dir.position.set(1.5, 2, 1.5);
    scene.add(dir);

    // Dimensions
    const BAG_W = 0.80; // width
    const BAG_H = 0.50; // height
    const BAG_D = 0.26; // depth
    const RADIUS = 0.06;

    // Materials
    const bodyMat = new THREE.MeshPhysicalMaterial({ color: '#2d2d4f', roughness: 0.6, metalness: 0.0, clearcoat: 0.25, clearcoatRoughness: 0.35 });
    const panelMat = new THREE.MeshPhysicalMaterial({ color: '#111111', roughness: 0.85, metalness: 0.0 });
    const handleMat = new THREE.MeshPhysicalMaterial({ color: '#2a2a2a', roughness: 0.8, metalness: 0.0 });
    const hwMat = new THREE.MeshPhysicalMaterial({ color: '#c9a646', metalness: 1.0, roughness: 0.2 }); // hardware

    // Rounded body
    const bodyGeo = new RoundedBoxGeometry(BAG_W, BAG_H, BAG_D, 4, RADIUS);
    const body = new THREE.Mesh(bodyGeo, bodyMat);
    body.position.set(0, BAG_H * 0.5 * 0.9, 0);
    body.castShadow = true; body.receiveShadow = true;
    scene.add(body);

    // Diagonal lower panel on front face
    const panelShape = new THREE.Shape();
    const panelW = BAG_W * 0.9;
    const panelH = BAG_H * 0.35;
    panelShape.moveTo(-panelW/2, -panelH/2);
    panelShape.lineTo(panelW/2, -panelH/2);
    panelShape.lineTo(panelW*0.15, panelH/2);
    panelShape.lineTo(-panelW/2, panelH/2);
    panelShape.closePath();
    const panelGeo = new THREE.ExtrudeGeometry(panelShape, { depth: 0.004, bevelEnabled: false });
    const panel = new THREE.Mesh(panelGeo, panelMat);
    panel.rotation.y = 0; // facing +Z
    panel.position.set(0, BAG_H * 0.25, BAG_D/2 + 0.002);
    scene.add(panel);

    // Top zipper/hardware hint
    const zipper = new THREE.Mesh(new THREE.CylinderGeometry(0.0025, 0.0025, BAG_W*0.92, 16), hwMat);
    zipper.rotation.z = Math.PI / 2;
    zipper.position.set(0, BAG_H*0.52, 0);
    scene.add(zipper);

    // Handles (arched tubes)
    function makeHandle(xOffset) {
      const p0 = new THREE.Vector3(xOffset, BAG_H*0.45, BAG_D*0.12);
      const p1 = new THREE.Vector3(xOffset, BAG_H*0.70, BAG_D*0.00);
      const p2 = new THREE.Vector3(xOffset, BAG_H*0.70, -BAG_D*0.00);
      const p3 = new THREE.Vector3(xOffset, BAG_H*0.45, -BAG_D*0.12);
      const curve = new THREE.CatmullRomCurve3([p0, p1, p2, p3]);
      const tubeGeo = new THREE.TubeGeometry(curve, 80, 0.018, 16, false);
      return new THREE.Mesh(tubeGeo, handleMat);
    }
    const handleL = makeHandle(-BAG_W*0.22);
    const handleR = makeHandle(BAG_W*0.22);
    scene.add(handleL); scene.add(handleR);

    // Small side pockets (subtle bulges)
    const pocketGeo = new RoundedBoxGeometry(0.18, 0.16, 0.06, 3, 0.02);
    const pocketL = new THREE.Mesh(pocketGeo, panelMat);
    pocketL.position.set(-BAG_W*0.36, BAG_H*0.22, 0);
    const pocketR = pocketL.clone(); pocketR.position.set(BAG_W*0.36, BAG_H*0.22, 0);
    scene.add(pocketL, pocketR);

    // Resize handling
    function onResize() {
      const w = container.clientWidth, h = container.clientHeight;
      camera.aspect = w / h; camera.updateProjectionMatrix();
      renderer.setSize(w, h);
    }
    window.addEventListener('resize', onResize);

    // Animation loop
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    // Helpers
    const texLoader = new THREE.TextureLoader();
    function applyTexture(path) {
      texLoader.load(path, (tex) => {
        tex.colorSpace = THREE.SRGBColorSpace;
        tex.wrapS = tex.wrapT = THREE.RepeatWrapping;
        bodyMat.map = tex;
        bodyMat.color.set('#ffffff');
        bodyMat.needsUpdate = true;
      });
    }
    function clearTexture() {
      bodyMat.map = null; bodyMat.needsUpdate = true;
    }

    // Controls wiring
    document.querySelectorAll('.swatch').forEach(s => {
      s.addEventListener('click', () => {
        clearTexture();
        bodyMat.color.set(s.dataset.color);
      });
    });
    document.getElementById('apply-texture-1').addEventListener('click', () => {
      applyTexture('../../images/Gemini_Generated_Image_mwmxxemwmxxemwmx.png');
    });
    document.getElementById('apply-texture-2').addEventListener('click', () => {
      applyTexture('../../images/Gemini_Generated_Image_j8e9c1j8e9c1j8e9.png');
    });
    document.getElementById('clear-texture').addEventListener('click', clearTexture);

    document.getElementById('toggle-handles').addEventListener('click', () => {
      const vis = !handleL.visible;
      handleL.visible = vis; handleR.visible = vis;
    });

    document.getElementById('hardware-select').addEventListener('change', (e) => {
      const val = e.target.value;
      if (val === 'gold') { hwMat.color.set('#c9a646'); hwMat.metalness = 1.0; hwMat.roughness = 0.2; }
      if (val === 'silver') { hwMat.color.set('#cfd3d6'); hwMat.metalness = 1.0; hwMat.roughness = 0.15; }
      if (val === 'matte') { hwMat.color.set('#1a1a1a'); hwMat.metalness = 0.2; hwMat.roughness = 0.8; }
    });

    // Demo GLB load to show swap-in readiness (public sample)
    let glbRoot = null;
    function clearPlaceholder() {
      [body, panel, zipper, handleL, handleR, pocketL, pocketR].forEach(m => scene.remove(m));
    }
    document.getElementById('load-demo-glb').addEventListener('click', () => {
      const loader = new GLTFLoader();
      loader.load('https://modelviewer.dev/shared-assets/models/Astronaut.glb', (gltf) => {
        if (glbRoot) scene.remove(glbRoot);
        clearPlaceholder();
        glbRoot = gltf.scene; glbRoot.scale.set(1.2, 1.2, 1.2);
        scene.add(glbRoot);
      });
    });

    // Expose a helper to load your future GLB
    window.loadBagGLB = function(url) {
      const loader = new GLTFLoader();
      loader.load(url, (gltf) => {
        if (glbRoot) scene.remove(glbRoot);
        clearPlaceholder();
        glbRoot = gltf.scene; scene.add(glbRoot);
      });
    }

    onResize();
  </script>

  <script src="/shared/script.js"></script>
</body>
</html>