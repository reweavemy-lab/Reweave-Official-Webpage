<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
        <link rel="icon" type="image/x-icon" href="/Users/howiesim/Documents/Reweave Official Webpage/images/Reweave logo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Detail - Reweave</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <style>
        /* Product Detail Specific Styles */
        .product-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            padding: 2rem 0;
        }
        
        .product-images {
            flex: 1;
            min-width: 300px;
        }
        
        .main-image {
            width: 100%;
            height: 500px;
            object-fit: cover;
            margin-bottom: 1rem;
            border-radius: 4px;
        }
        
        .image-thumbnails {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
        }
        
        .thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            cursor: pointer;
            border-radius: 4px;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        
        .thumbnail:hover, .thumbnail.active {
            opacity: 1;
        }
        
        .product-info {
            flex: 1;
            min-width: 300px;
        }
        
        .product-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .product-price {
            font-size: 1.5rem;
            color: #3a5a40;
            margin-bottom: 1rem;
        }
        
        .product-description {
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .product-meta {
            margin-bottom: 2rem;
        }
        
        .meta-item {
            display: flex;
            margin-bottom: 0.5rem;
        }
        
        .meta-label {
            width: 120px;
            font-weight: 600;
        }
        
        .size-options, .color-options {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .size-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .size-option:hover, .size-option.selected {
            background-color: #3a5a40;
            color: white;
            border-color: #3a5a40;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .color-option:hover, .color-option.selected {
            transform: scale(1.2);
            box-shadow: 0 0 0 2px white, 0 0 0 4px #3a5a40;
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .quantity-btn {
            width: 40px;
            height: 40px;
            background: #f5f5f5;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .quantity-input {
            width: 60px;
            height: 40px;
            text-align: center;
            border: 1px solid #ddd;
            margin: 0 0.5rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .add-to-cart, .try-on-btn, .customize-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .add-to-cart {
            background-color: #3a5a40;
            color: white;
            flex: 2;
        }
        
        .add-to-cart:hover {
            background-color: #2d4330;
        }
        
        .try-on-btn, .wishlist-btn, .customize-btn {
            background-color: #f5f5f5;
            color: #333;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .try-on-btn:hover, .wishlist-btn:hover, .customize-btn:hover {
            background-color: #e5e5e5;
        }
        
        .product-tabs {
            margin-top: 3rem;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        
        .tab-btn {
            padding: 1rem 2rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
        }
        
        .tab-btn.active {
            border-bottom-color: #3a5a40;
            color: #3a5a40;
        }
        
        .tab-content {
            padding: 2rem 0;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .sustainability-metrics {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .metric {
            flex: 1;
            min-width: 200px;
            background: #f9f9f9;
            padding: 1.5rem;
            border-radius: 4px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #3a5a40;
            margin-bottom: 0.5rem;
        }
        
        .related-products {
            margin-top: 4rem;
        }
        
        .related-title {
            font-size: 1.8rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        @media (max-width: 768px) {
            .product-container {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
  <!-- Font Awesome for header icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <header class="luxury-header">
        <div class="header-container">
            <div class="header-left">
                <button class="menu-btn" aria-label="Menu">
                    <i class="fas fa-bars"></i>
                    <span>Menu</span>
                </button>
                <button class="search-btn" aria-label="Search">
                    <i class="fas fa-search"></i>
                    <span>Search</span>
                </button>
            </div>
            <div class="logo-center">
            <a href="/onepage.html">REWEAVE</a>
            </div>
            <div class="header-right">
                <button class="utility-btn" aria-label="Call Us"><span>Call Us</span></button>
                <button class="utility-btn" aria-label="Wishlist"><i class="fas fa-heart"></i></button>
                <button class="utility-btn" aria-label="Account"><i class="fas fa-user"></i></button>
                <button class="utility-btn cart-btn" aria-label="Cart"><i class="fas fa-shopping-bag"></i><span class="cart-count">0</span></button>
            </div>
        </div>
        <nav class="hidden-nav">
            <div class="nav-content">
                <button class="close-nav" aria-label="Close">
                    <i class="fas fa-times"></i>
                    <span>Close</span>
                </button>
                <div class="nav-categories">
                    <div class="nav-section">
                        <h3>New</h3>
                        <ul>
                            <li><a href="../index.html">Latest Arrivals</a></li>
                            <li><a href="../index.html">Limited Edition</a></li>
                        </ul>
                    </div>
                    <div class="nav-section">
                        <h3>Bags and Accessories</h3>
                        <ul>
                            <li><a href="index.html">Totes</a></li>
                            <li><a href="index.html">Slings</a></li>
                            <li><a href="index.html">Accessories</a></li>
                        </ul>
                    </div>
                    <div class="nav-section">
                        <h3>Collections</h3>
                        <ul>
                            <li><a href="index.html">Batik Heritage</a></li>
                            <li><a href="index.html">Artisan Series</a></li>
                        </ul>
                    </div>
                    <div class="nav-section">
                        <h3>About</h3>
                        <ul>
                            <li><a href="../story/index.html">Our Story</a></li>
                            <li><a href="../community/index.html">Community</a></li>
                            <li><a href="../impact/index.html">Impact</a></li>
                            <li><a href="../journal/index.html">Journal</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <div class="container">
            <nav class="breadcrumb" aria-label="breadcrumb">
                <ol>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="index.html">Shop</a></li>
                    <li>Handwoven Cotton Dress</li>
                </ol>
            </nav>

            <div class="product-container">
                <div class="product-images">
                    <img src="https://images.pexels.com/photos/6626903/pexels-photo-6626903.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Handwoven Cotton Dress" class="main-image">
                    <div class="image-thumbnails">
                        <img src="https://images.pexels.com/photos/6626903/pexels-photo-6626903.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Thumbnail 1" class="thumbnail active">
                        <img src="https://images.pexels.com/photos/6626967/pexels-photo-6626967.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Thumbnail 2" class="thumbnail">
                        <img src="https://images.pexels.com/photos/6626963/pexels-photo-6626963.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Thumbnail 3" class="thumbnail">
                        <img src="https://images.pexels.com/photos/6626968/pexels-photo-6626968.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Thumbnail 4" class="thumbnail">
                    </div>
                </div>

                <div class="product-info">
                    <h1 class="product-title">Handwoven Cotton Dress</h1>
                    <div class="product-price">$129.00</div>
                    <div class="product-description">
                        <p>This beautiful handwoven cotton dress is crafted by skilled artisans using traditional techniques passed down through generations. The breathable fabric is perfect for warm weather, while the timeless design ensures you'll treasure this piece for years to come.</p>
                    </div>

                    <div class="product-meta">
                        <div class="meta-item">
                            <span class="meta-label">Material:</span>
                            <span>100% Organic Cotton</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Origin:</span>
                            <span>Handcrafted in India</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Artisan:</span>
                            <span><a href="../artisan/index.html">Priya Collective</a></span>
                        </div>
                    </div>

                    <div class="size-section">
                        <h3>Size</h3>
                        <div class="size-options">
                            <div class="size-option">XS</div>
                            <div class="size-option selected">S</div>
                            <div class="size-option">M</div>
                            <div class="size-option">L</div>
                            <div class="size-option">XL</div>
                        </div>
                        <a href="#" class="size-guide-link">Size Guide</a>
                    </div>

                    <div class="color-section">
                        <h3>Color</h3>
                        <div class="color-options">
                            <div class="color-option selected" style="background-color: #e8d2a0;" title="Natural"></div>
                            <div class="color-option" style="background-color: #86a397;" title="Sage"></div>
                            <div class="color-option" style="background-color: #b57c65;" title="Terracotta"></div>
                            <div class="color-option" style="background-color: #4a6c8c;" title="Indigo"></div>
                        </div>
                    </div>

                    <div class="quantity-selector">
                        <button class="quantity-btn decrease">-</button>
                        <input type="number" class="quantity-input" value="1" min="1" max="10">
                        <button class="quantity-btn increase">+</button>
                    </div>

                    <div class="action-buttons">
                        <button class="add-to-cart">Add to Cart</button>
                        <button class="customize-btn">
                            <span class="material-icons">tune</span>
                            Customize
                        </button>
                        <button class="try-on-btn">
                            <span class="material-icons">person</span>
                            Try On
                        </button>
                        <button class="wishlist-btn">
                            <span class="material-icons">favorite_border</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="product-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="details">Details</button>
                    <button class="tab-btn" data-tab="sustainability">Sustainability</button>
                    <button class="tab-btn" data-tab="care">Care Instructions</button>
                    <button class="tab-btn" data-tab="shipping">Shipping & Returns</button>
                </div>

                <div class="tab-content">
                    <div class="tab-pane active" id="details">
                        <h3>Product Details</h3>
                        <p>This dress features:</p>
                        <ul>
                            <li>Handwoven cotton fabric with natural dyes</li>
                            <li>Relaxed fit with adjustable waist tie</li>
                            <li>Side pockets</li>
                            <li>Three-quarter length sleeves</li>
                            <li>Midi length</li>
                            <li>Slight V-neck</li>
                        </ul>
                        <p>Each piece is unique with subtle variations in the weave and color, showcasing the handmade nature of the garment.</p>
                    </div>

                    <div class="tab-pane" id="sustainability">
                        <h3>Sustainability Impact</h3>
                        <p>At Reweave, we believe in transparency. Here's how this product makes a positive impact:</p>
                        
                        <div class="sustainability-metrics">
                            <div class="metric">
                                <div class="metric-value">95%</div>
                                <div class="metric-label">Less Water Used</div>
                                <p>Compared to conventional cotton production</p>
                            </div>
                            <div class="metric">
                                <div class="metric-value">0</div>
                                <div class="metric-label">Synthetic Materials</div>
                                <p>100% natural, biodegradable materials</p>
                            </div>
                            <div class="metric">
                                <div class="metric-value">4</div>
                                <div class="metric-label">Artisans Supported</div>
                                <p>Direct impact on artisan livelihoods</p>
                            </div>
                        </div>
                        
                        <p>This product is made with GOTS certified organic cotton, natural dyes, and traditional handloom techniques that preserve cultural heritage while minimizing environmental impact.</p>
                    </div>

                    <div class="tab-pane" id="care">
                        <h3>Care Instructions</h3>
                        <p>To preserve the beauty and longevity of your handwoven garment:</p>
                        <ul>
                            <li>Hand wash in cold water with mild soap</li>
                            <li>Do not bleach</li>
                            <li>Hang to dry in shade</li>
                            <li>Iron on low heat if needed</li>
                            <li>Store folded in a cool, dry place</li>
                        </ul>
                        <p>Natural dyes may slightly fade over time, which is part of the charm of sustainable fashion.</p>
                    </div>

                    <div class="tab-pane" id="shipping">
                        <h3>Shipping & Returns</h3>
                        <p>We ship worldwide with carbon-neutral delivery options:</p>
                        <ul>
                            <li>Standard Shipping (3-5 business days): $5.99</li>
                            <li>Express Shipping (1-2 business days): $12.99</li>
                            <li>Free shipping on orders over $100</li>
                        </ul>
                        <p>Returns and exchanges are accepted within 30 days of delivery. Items must be unworn with original tags attached. Read our full <a href="#">Return Policy</a> for more details.</p>
                    </div>
                </div>
            </div>

            <div class="related-products">
                <h2 class="related-title">You May Also Like</h2>
                <div class="related-grid">
                    <div class="product-card">
                        <div class="product-image">
                            <img src="https://images.pexels.com/photos/6626987/pexels-photo-6626987.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Related Product 1">
                            <div class="product-actions">
                                <button class="quick-view">Quick View</button>
                                <button class="add-to-wishlist">
                                    <span class="material-icons">favorite_border</span>
                                </button>
                            </div>
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">Handwoven Scarf</h3>
                            <div class="product-price">$49.00</div>
                        </div>
                    </div>
                    <div class="product-card">
                        <div class="product-image">
                            <img src="https://images.pexels.com/photos/6626979/pexels-photo-6626979.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Related Product 2">
                            <div class="product-actions">
                                <button class="quick-view">Quick View</button>
                                <button class="add-to-wishlist">
                                    <span class="material-icons">favorite_border</span>
                                </button>
                            </div>
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">Organic Cotton Top</h3>
                            <div class="product-price">$79.00</div>
                        </div>
                    </div>
                    <div class="product-card">
                        <div class="product-image">
                            <img src="https://images.pexels.com/photos/6626892/pexels-photo-6626892.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Related Product 3">
                            <div class="product-actions">
                                <button class="quick-view">Quick View</button>
                                <button class="add-to-wishlist">
                                    <span class="material-icons">favorite_border</span>
                                </button>
                            </div>
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">Woven Tote Bag</h3>
                            <div class="product-price">$59.00</div>
                        </div>
                    </div>
                    <div class="product-card">
                        <div class="product-image">
                            <img src="https://images.pexels.com/photos/6626974/pexels-photo-6626974.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Related Product 4">
                            <div class="product-actions">
                                <button class="quick-view">Quick View</button>
                                <button class="add-to-wishlist">
                                    <span class="material-icons">favorite_border</span>
                                </button>
                            </div>
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">Block Print Skirt</h3>
                            <div class="product-price">$89.00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="luxury-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h4>Help</h4>
                    <ul class="footer-links">
                        <li><a href="#">Client Advisor: 1800 814 930</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Product Care</a></li>
                        <li><a href="#">Delivery, Returns & Exchanges</a></li>
                        <li><a href="#">Stores</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Services</h4>
                    <ul class="footer-links">
                        <li><a href="#">Repairs</a></li>
                        <li><a href="#">Personalisation</a></li>
                        <li><a href="#">Art of Gifting</a></li>
                        <li><a href="#">Download our Apps</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>About Reweave</h4>
                    <ul class="footer-links">
                        <li><a href="../story/index.html">Fashion & Craft</a></li>
                        <li><a href="../culture/index.html">Arts & Culture</a></li>
                        <li><a href="../story/index.html">Our Maison</a></li>
                        <li><a href="../impact/index.html">Sustainability</a></li>
                        <li><a href="../journal/index.html">Latest News</a></li>
                        <li><a href="../story/index.html#careers">Careers</a></li>
                        <li><a href="../community/index.html">Foundation</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Connect</h4>
                    <ul class="footer-links">
                        <li><a href="#">Sign up for emails</a></li>
                        <li><a href="#">Follow Us</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-sub">
                <div class="footer-locale">Ship to: <a href="#">Malaysia</a></div>
                <div class="footer-legal">
                    <a href="#">Sitemap</a>
                    <a href="#">Legal & Privacy</a>
                </div>
            </div>

            <div class="footer-brand">REWEAVE</div>
        </div>
    </footer>
    
    <script>
        // Product Detail Page: load by SKU and wire cart
        document.addEventListener('DOMContentLoaded', function() {
            const API_BASE = 'http://localhost:3001/api';
            const params = new URLSearchParams(window.location.search);
            const sku = params.get('sku');
            const legacyId = params.get('id');

            const mainImage = document.querySelector('.main-image');
            const thumbnailsWrap = document.querySelector('.image-thumbnails');
            const titleEl = document.querySelector('.product-title');
            const priceEl = document.querySelector('.product-price');
            const descEl = document.querySelector('.product-description');
            const breadcrumbLast = document.querySelector('.breadcrumb li:last-child');
            const qtyInput = document.querySelector('.quantity-input');
            const addBtn = document.querySelector('.add-to-cart');
            const customizeBtn = document.querySelector('.customize-btn');

            function formatMYR(n) { return `RM ${Number(n || 0).toFixed(2)}`; }
            function getCart() { try { return JSON.parse(localStorage.getItem('cart')||'[]'); } catch(e) { return []; } }
            function setCart(c) { localStorage.setItem('cart', JSON.stringify(c)); }
            function updateCartCount() {
                const cart = getCart();
                const count = cart.reduce((sum, i) => sum + (i.qty || 1), 0);
                const el = document.querySelector('.cart-count');
                if (el) el.textContent = count;
            }

            function renderImages(images) {
                const imgs = Array.isArray(images) && images.length ? images : ['https://via.placeholder.com/900x900?text=Reweave'];
                mainImage.src = imgs[0];
                thumbnailsWrap.innerHTML = imgs.map((src, idx) => `<img src="${src}" alt="Image ${idx+1}" class="thumbnail ${idx===0?'active':''}">`).join('');
                const thumbnails = thumbnailsWrap.querySelectorAll('.thumbnail');
                thumbnails.forEach(thumb => {
                    thumb.addEventListener('click', function() {
                        mainImage.src = this.src;
                        thumbnails.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
            }

            function wireTabs() {
                const tabButtons = document.querySelectorAll('.tab-btn');
                const tabPanes = document.querySelectorAll('.tab-pane');
                tabButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');
                        tabButtons.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        tabPanes.forEach(p => p.classList.remove('active'));
                        document.getElementById(tabId).classList.add('active');
                    });
                });
            }

            function wireQuantity() {
                const decreaseBtn = document.querySelector('.decrease');
                const increaseBtn = document.querySelector('.increase');
                decreaseBtn.addEventListener('click', function() {
                    const v = parseInt(qtyInput.value || '1', 10);
                    qtyInput.value = Math.max(1, v - 1);
                });
                increaseBtn.addEventListener('click', function() {
                    const v = parseInt(qtyInput.value || '1', 10);
                    qtyInput.value = Math.min(10, v + 1);
                });
            }

            function loadBySku(sku) {
                // 1) Get variant/inventory by SKU -> productId
                fetch(`${API_BASE}/inventory/${encodeURIComponent(sku)}`)
                  .then(r => r.json())
                  .then(invResp => {
                    if (!invResp.ok || !invResp.inventory) throw new Error('not_found');
                    const inv = invResp.inventory;
                    // 2) Get product by productId
                    return fetch(`${API_BASE}/products/${encodeURIComponent(inv.productId)}`).then(r => r.json()).then(prodResp => ({ inv, prodResp }));
                  })
                  .then(({ inv, prodResp }) => {
                    const p = prodResp.product || prodResp.products || prodResp;
                    titleEl.textContent = p.title || p.name || 'Product';
                    priceEl.textContent = formatMYR(inv.price || (p.price || 0));
                    descEl.innerHTML = `<p>${(p.description || '').trim()}</p>`;
                    if (breadcrumbLast) breadcrumbLast.textContent = (p.title || p.name || sku);
                    renderImages(p.images || []);
                    updateCartCount();
                    addBtn.addEventListener('click', function() {
                        const cart = getCart();
                        const qty = parseInt(qtyInput.value || '1', 10);
                        const optionsArr = [];
                        const opt = inv.options || {};
                        Object.entries(opt).forEach(([k,v]) => optionsArr.push(`${k}: ${v}`));
                        const item = {
                            id: inv.sku,
                            name: (p.title || p.name || 'Product'),
                            price: Number(inv.price || 0),
                            qty,
                            image: mainImage.src,
                            options: optionsArr.join(' â€¢ '),
                            addon: false
                        };
                        const existing = cart.find(i => i.id === item.id && i.options === item.options);
                        if (existing) existing.qty += qty; else cart.push(item);
                        setCart(cart);
                        updateCartCount();
                        window.location.href = '../cart/index.html';
                    });
                    customizeBtn.addEventListener('click', function() {
                        // Pass product id for preselection
                        const pid = p.id || p.productId || '';
                        window.location.href = `configure.html?productId=${encodeURIComponent(pid)}`;
                    });
                  })
                  .catch(err => {
                    console.error('Failed to load SKU', err);
                    titleEl.textContent = 'Not Found';
                    priceEl.textContent = formatMYR(0);
                    descEl.innerHTML = '<p>We couldn\'t find this item. Please go back to the shop.</p>';
                    renderImages([]);
                  });
            }

            function loadById(id) {
                fetch(`${API_BASE}/products/${encodeURIComponent(id)}`)
                  .then(r => r.json())
                  .then(resp => {
                    const p = resp.product || resp.products || resp;
                    titleEl.textContent = p.title || p.name || 'Product';
                    const v0 = (p.variants || [])[0];
                    priceEl.textContent = formatMYR((v0 && v0.price) || p.price || 0);
                    descEl.innerHTML = `<p>${(p.description || '').trim()}</p>`;
                    if (breadcrumbLast) breadcrumbLast.textContent = (p.title || p.name || id);
                    renderImages(p.images || []);
                    updateCartCount();
                    addBtn.addEventListener('click', function() {
                        const cart = getCart();
                        const qty = parseInt(qtyInput.value || '1', 10);
                        const item = {
                            id: (v0 && v0.sku) || id,
                            name: (p.title || p.name || 'Product'),
                            price: Number((v0 && v0.price) || p.price || 0),
                            qty,
                            image: mainImage.src,
                            options: '',
                            addon: false
                        };
                        const existing = cart.find(i => i.id === item.id && i.options === item.options);
                        if (existing) existing.qty += qty; else cart.push(item);
                        setCart(cart);
                        updateCartCount();
                        window.location.href = '../cart/index.html';
                    });
                    customizeBtn.addEventListener('click', function() {
                        const pid = p.id || id;
                        window.location.href = `configure.html?productId=${encodeURIComponent(pid)}`;
                    });
                  })
                  .catch(err => {
                    console.error('Failed to load product id', err);
                    titleEl.textContent = 'Not Found';
                    priceEl.textContent = formatMYR(0);
                    descEl.innerHTML = '<p>We couldn\'t find this item. Please go back to the shop.</p>';
                    renderImages([]);
                  });
            }

            // Kick off
            wireTabs();
            wireQuantity();
            if (sku) loadBySku(sku); else if (legacyId) loadById(legacyId); else loadById('luxe-mini');
        });
    </script>
<script src="../../script.js"></script>
</body>
</html>