<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Detail â€¢ Reweave</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="../../styles/shop.css" />
</head>
<body>
  <header class="luxury-header">
    <div class="header-container">
      <div class="header-left">
        <button class="menu-btn" aria-label="Menu" onclick="history.back()">
          <i class="fas fa-arrow-left"></i>
          <span>Back</span>
        </button>
        <button class="menu-btn" aria-label="AI Try-On" onclick="window.location.href='../tryon/index.html'" title="AI Try-On">
          <i class="fas fa-tshirt"></i>
          <span>AI Try-On</span>
        </button>
      </div>
      <div class="logo-center"><a href="/onepage.html">REWEAVE</a></div>
      <div class="header-right">
        <button class="utility-btn cart-btn" aria-label="Cart"><i class="fas fa-shopping-bag"></i><span class="cart-count">0</span></button>
      </div>
    </div>
  </header>

  <main class="container" style="padding: 32px 16px;">
    <div id="detail" style="display:grid;grid-template-columns:1fr 1fr;gap:32px;align-items:start;">
      <div id="detail-image-wrap">
        <img id="detail-image" src="" alt="Product image" style="width:100%;height:auto;border-radius:12px;object-fit:cover;" />
      </div>
      <div>
        <h1 id="detail-title" style="font-size:2rem;margin-bottom:8px;">Product</h1>
        <div id="detail-price" style="font-size:1.25rem;margin-bottom:12px;">RM 0.00</div>
        <div id="detail-material" style="color:#555;margin-bottom:12px;"></div>
        <div id="detail-sustain" style="color:#555;margin-bottom:16px;"></div>
        <p id="detail-desc" style="line-height:1.6;margin-bottom:16px;"></p>
        <div style="display:flex;gap:12px;">
          <a id="detail-tryon" href="../tryon/index.html" class="item-btn primary" style="display:inline-block;padding:10px 14px;border-radius:8px;background:#111;color:#fff;text-decoration:none;"><i class="fas fa-tshirt"></i> AI Try-On</a>
          <button id="detail-add" class="item-btn secondary" style="display:inline-block;padding:10px 14px;border-radius:8px;background:#fff;color:#111;border:1px solid #e0e0e0;">Add to Bag</button>
        </div>
      </div>
    </div>
  </main>

  <footer class="luxury-footer">
    <div class="container">
      <div class="footer-brand">REWEAVE</div>
    </div>
  </footer>

  <script>
    const API_PRODUCTS = 'http://localhost:3001/api/products';
    const params = new URLSearchParams(window.location.search);
    const sku = params.get('sku');
    const getCart = () => JSON.parse(localStorage.getItem('cart') || '[]');
    const setCart = c => localStorage.setItem('cart', JSON.stringify(c));
    const formatMYR = v => `RM ${Number(v || 0).toFixed(2)}`;

    document.addEventListener('DOMContentLoaded', () => {
      fetch(API_PRODUCTS)
        .then(r => r.json())
        .then(data => {
          const list = Array.isArray(data) ? data : (data.products || []);
          let product = list.find(p => {
            const variants = p.variants || [];
            return (p.id === sku) || variants.some(v => v.sku === sku);
          }) || list[0];
          if (!product) return;
          const firstImage = (product.images && product.images[0]) || 'https://via.placeholder.com/800x800?text=Reweave';
          const minVariant = (product.variants || [])[0] || { price: product.price || 0, sku: product.id };
          const minPrice = (product.variants || []).reduce((m, v) => Math.min(m, Number(v.price || 0)), Number(minVariant.price || 0));

          document.getElementById('detail-image').src = firstImage;
          document.getElementById('detail-title').textContent = product.name || 'Product';
          document.getElementById('detail-price').textContent = formatMYR(minPrice);
          document.getElementById('detail-material').textContent = product.material ? `Material: ${product.material}` : '';
          document.getElementById('detail-sustain').textContent = product.sustainability ? `Impact: ${product.sustainability}` : '';
          document.getElementById('detail-desc').textContent = product.description || '';
          const tryon = document.getElementById('detail-tryon');
          tryon.href = `../tryon/index.html?product=${encodeURIComponent(product.name || '')}`;

          document.getElementById('detail-add').addEventListener('click', () => {
            const cart = getCart();
            const item = {
              id: minVariant.sku || product.id,
              name: product.name,
              price: Number(minVariant.price || minPrice),
              qty: 1,
              image: firstImage,
              options: '',
              addon: false
            };
            const existing = cart.find(i => i.id === item.id && i.options === item.options);
            if (existing) existing.qty += 1; else cart.push(item);
            setCart(cart);
            alert('Added to bag');
          });
        })
        .catch(err => {
          console.error(err);
        });
    });
  </script>
</body>
</html>
